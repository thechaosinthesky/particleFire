(function(){"use strict";var a,b,c,d=function(a,b){return function(){return a.apply(b,arguments)}};a=jQuery,b=function(){function a(){}return a.transitions={webkitTransition:"webkitTransitionEnd",mozTransition:"mozTransitionEnd",oTransition:"oTransitionEnd",transition:"transitionend"},a.transition=function(a){var b,c,d,e;b=a[0],c=this.transitions;for(e in c)if(d=c[e],null!=b.style[e])return d},a}(),c=function(){function c(b){null==b&&(b={}),this.container=d(this.container,this),this.content=d(this.content,this),this.html=d(this.html,this),this.$growl=d(this.$growl,this),this.$growls=d(this.$growls,this),this.animate=d(this.animate,this),this.remove=d(this.remove,this),this.dismiss=d(this.dismiss,this),this.present=d(this.present,this),this.cycle=d(this.cycle,this),this.close=d(this.close,this),this.click=d(this.click,this),this.unbind=d(this.unbind,this),this.bind=d(this.bind,this),this.render=d(this.render,this),this.settings=a.extend({},c.settings,b),this.$growls().attr("class",this.settings.location),this.render()}return c.settings={namespace:"growl",duration:3200,close:"&#215;",location:"default",style:"default",size:"medium"},c.growl=function(a){return null==a&&(a={}),this.initialize(),new c(a)},c.initialize=function(){return a("body:not(:has(#growls))").append('<div id="growls" />')},c.prototype.render=function(){var a;a=this.$growl(),this.$growls().append(a),this.settings.fixed?this.present():this.cycle()},c.prototype.bind=function(a){return null==a&&(a=this.$growl()),a.on("click",this.click),a.on("contextmenu",this.close).find("."+this.settings.namespace+"-close").on("click",this.close)},c.prototype.unbind=function(a){return null==a&&(a=this.$growl()),a.off("click",this.click),a.off("contextmenu",this.close).find("."+this.settings.namespace+"-close").off("click",this.close)},c.prototype.click=function(a){return null!=this.settings.url?(a.preventDefault(),a.stopPropagation(),window.open(this.settings.url)):void 0},c.prototype.close=function(a){var b;return a.preventDefault(),a.stopPropagation(),b=this.$growl(),b.stop().queue(this.dismiss).queue(this.remove)},c.prototype.cycle=function(){var a;return a=this.$growl(),a.queue(this.present).delay(this.settings.duration).queue(this.dismiss).queue(this.remove)},c.prototype.present=function(a){var b;return b=this.$growl(),this.bind(b),this.animate(b,this.settings.namespace+"-incoming","out",a)},c.prototype.dismiss=function(a){var b;return b=this.$growl(),this.unbind(b),this.animate(b,this.settings.namespace+"-outgoing","in",a)},c.prototype.remove=function(a){return this.$growl().remove(),a()},c.prototype.animate=function(a,c,d,e){var f;null==d&&(d="in"),f=b.transition(a),a["in"===d?"removeClass":"addClass"](c),a.offset().position,a["in"===d?"addClass":"removeClass"](c),null!=e&&(null!=f?a.one(f,e):e())},c.prototype.$growls=function(){return null!=this.$_growls?this.$_growls:this.$_growls=a("#growls")},c.prototype.$growl=function(){return null!=this.$_growl?this.$_growl:this.$_growl=a(this.html())},c.prototype.html=function(){return this.container(this.content())},c.prototype.content=function(){return"<div class='"+this.settings.namespace+"-close'>"+this.settings.close+"</div>\n<div class='"+this.settings.namespace+"-title'>"+this.settings.title+"</div>\n<div class='"+this.settings.namespace+"-message'>"+this.settings.message+"</div>"},c.prototype.container=function(a){return"<div class='"+this.settings.namespace+" "+this.settings.namespace+"-"+this.settings.style+" "+this.settings.namespace+"-"+this.settings.size+"'>\n  "+a+"\n</div>"},c}(),this.Growl=c,a.growl=function(a){return null==a&&(a={}),c.growl(a)},a.growl.error=function(b){var c;return null==b&&(b={}),c={title:"Error!",style:"error"},a.growl(a.extend(c,b))},a.growl.notice=function(b){var c;return null==b&&(b={}),c={title:"Notice!",style:"notice"},a.growl(a.extend(c,b))},a.growl.warning=function(b){var c;return null==b&&(b={}),c={title:"Warning!",style:"warning"},a.growl(a.extend(c,b))}}).call(this);var ParticleFire={App:{},init:function(){},initControlPanel:function(a){this.App.profiles=new ParticleFire.Collections.Profile([]),this.App.controlPanel=new ParticleFire.Views.ControlPanel({el:"#profiles"}),this.App.router=new ParticleFire.Routers.ControlPanel({}),this.App.user={},this.App.user.devices=new Backbone.Collection,this.App.user.devices.url="/account/devices",this.App.user.devices.fetch()},login:function(a){},properties:{},Templates:{},Models:{},Collections:{},Views:{},Routers:{}};_.extend(Backbone.Validation.callbacks,{valid:function(a,b,c){var d=a.$el.find("[name="+b+"]"),e=d.closest(".form-group");e.length&&e.removeClass("has-error"),d.popover("destroy")},invalid:function(a,b,c,d){var e=a.$el.find("[name="+b+"]"),f=e.closest(".form-group");f.length&&f.addClass("has-error");var g=e.attr("data-error-placement");g||(g="right"),e.popover({content:c,placement:g}).popover("show")}}),_.mixin({renderIfDefined:function(a,b){var c=a[b];return console.log(b),console.log(a),"undefined"!=typeof c?c:""},bindFormView:function(a){if(a.model&&a.$el)for(var b in a.model.attributes)a.$el.find("[name="+b+"]").change(function(){var b=$(this),c=b.attr("name"),d={};d[c]=$(this).val(),a.model.set(d,{silent:!0})})}});var BootstrapSelect=Backbone.View.extend({defaultOptions:{labelAttribute:"label",valueAttribute:"value"},events:{change:"onChange"},initialize:function(a){this.values=a.values,this.value=a.value,this.options=$.extend({},this.defaultOptions,a),this.render()},render:function(){this.value||this.$el.append('<option class="selection"> - SELECT - </option>');for(var a in this.values){var b=this.values[a],c=b==this.value;this.$el.append('<option class="selection" '+(c?"selected":"")+' value="'+b[this.options.valueAttribute]+'">'+b[this.options.labelAttribute]+"</option>")}},onChange:function(a){this.trigger("change",this.$el.val())}});ParticleFire.Templates.Loader='<span>LOADING&nbsp;&nbsp;&nbsp;<i class="fa fa-fire fa-spin"></i></span>',ParticleFire.Templates.Loader_Profiles='<li class="active"><a>LOADING</a></li> <li><a><span><i class="fa fa-fire fa-spin"></i></span></a></li>',ParticleFire.Templates.Modal='\n<div class="modal in" tabindex="-1" role="dialog" aria-labelledby="Modal Dialog">  <div class="modal-dialog modal-lg">    <div class="modal-content">      <div class="modal-header">        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">Ã—</span></button>          <h4 class="modal-title" id="modal"><%= header %></h4>      </div>      <div class="modal-body"> </div>      <div class="modal-footer"> <div class="modal-buttons"> <button class="pull-right btn btn-primary btn-save">SAVE</button> <button class="pull-right btn btn-default btn-cancel">CANCEL</button> </div> </div> </div> </div> </div>',ParticleFire.Templates.ProfileTab='\n<li class="<%= classes %>" role="presentation"><a href="#<%= profile_content_id %>" aria-controls="#<%= profile_content_id %>" role="tab" data-toggle="tab"><%= name %></a></li>',ParticleFire.Templates.NoProfiles='\n<div class="well"><p>You haven\'t added any profiles yet.</p></div>',ParticleFire.Templates.TabProfileContent='\n<div role="tabpanel" class="tab-pane <%= classes %>" id="<%= profile_content_id %>"></div>',ParticleFire.Templates.Profile='\n<table id="ios" class="table table-striped">  <tbody class="io-list">    <tr>      <td class="cell-io-name active"> <i class="fa fa-gg"></i>&nbsp;&nbsp;        LOADING      </td>      <td class="cell-io-content"><span><i class="fa fa-fire fa-spin"></i></span></td>    </tr>  </tbody>  <tfoot>    <tr>      <td class="cell-io-name cell-io-new text-center">        <div class="io-new">          <div id="newIO" class="add-io btn-new-io btn btn-primary"><i class="fa fa-plus-circle"></i>&nbsp;            I/O          </div>        </div>      </td>      <td class="cell-io-content"> </td>    </tr>  </tfoot></table>',ParticleFire.Templates.ProfileEditContent='\n<form class="form-horizontal">  <div class="form-group">    <label for="profile-name" class="col-sm-2 control-label">Profile Name:</label>    <div class="col-sm-10">      <input type="input" class="form-control" id="profile-name" name="name" value="<%= name %>">    </div>  </div></form>',ParticleFire.Templates.IO='\n<tr>  <td class="cell-io-name cell-io-edit active">    <i class="fa fa-gg"></i>&nbsp;&nbsp;    <%= name %>    <span class="io-edit pull-right"><i class="fa fa-pencil"></i></span>  </td>  <td id="<%= _id %>" class="cell-io-content">Open/Closed</td></tr>',ParticleFire.Templates.IO_trigger='\n<tr>  <td class="cell-io-name cell-io-edit active">    <i class="fa fa-gg"></i>&nbsp;&nbsp;    <%= name %>    <span class="io-edit pull-right"><i class="fa fa-pencil"></i></span>  </td>  <td id="<%= _id %>" class="cell-io-content"><button type="button" class="io-trigger btn btn-danger"><i class="fa fa-lg fa-bolt danger"></i></button></td></tr>',ParticleFire.Templates.IOEditContent='\n<form class="form-horizontal">  <div class="form-group">    <label for="io-name" class="col-sm-2 control-label">I/O Name:</label>    <div class="col-sm-10">      <input type="input" class="form-control" id="io-name" name="name" value="<%= name %>">    </div>  </div>  <div class="form-group">    <label for="io-type" class="col-sm-2 control-label">I/O Type:</label>    <div class="col-sm-10">      <select id="io-type" name="type" class="form-control io-types-select"></select>    </div>  </div>  <div class="io-type-fields">  </div></form>',ParticleFire.Templates.IOEditType_trigger='\n<div class="form-group">  <label for="io-device-name" class="col-sm-2 control-label">Device:</label>  <div class="col-sm-10">    <select id="io-device" name="device_id" class="form-control io-devices-select">    </select>  </div></div>',ParticleFire.Templates.IOEditType_toggle='\n<div class="form-group">  <label for="io-device-name" class="col-sm-2 control-label">Device Name:</label>  <div class="col-sm-10">    <input type="input" class="form-control" id="io-device-name" value="<%= device_name %>">  </div></div><div class="form-group">  <label for="io-device-name" class="col-sm-2 control-label">Input ID:</label>  <div class="col-sm-10">    <input type="input" class="form-control" id="io-input-pin" value="<%= input_pin %>" placeholder="Example: A6">  </div></div>',ParticleFire.Models.IO=Backbone.Model.extend({idAttribute:"_id",types:[{value:"trigger",label:"Trigger"},{value:"toggle",label:"Toggle"},{value:"power_buttons",label:"Power Buttons"},{value:"reading",label:"Value Reading"},{value:"video",label:"Video Feed"}],defaults:{name:"",type:null,device_name:"",input_pin:"",output_pin:""},url:function(){return"/ios"},initialize:function(){},triggerAction:function(a){$.ajax({url:"/ios/"+this.id,method:"POST",body:{value:a}})}}),ParticleFire.Collections.IO=Backbone.Collection.extend({model:ParticleFire.Models.IO,url:function(){return"/ios?profile_id="+this.profile_id},initialize:function(a,b){this.profile_id=b.profile_id}}),ParticleFire.Models.Profile=Backbone.Model.extend({idAttribute:"_id",defaults:{name:""},url:function(){var a="/profiles";return this.id&&(a+="/"+this.id),a},initialize:function(){}}),ParticleFire.Collections.Profile=Backbone.Collection.extend({model:ParticleFire.Models.Profile,url:function(){return"/profiles"},initialize:function(){}}),ParticleFire.Models.User=Backbone.Model.extend({idAttribute:"_id",defaults:{username:"",password:""},validation:{username:[{required:!0,msg:"Please enter an email address"},{pattern:"email",msg:"Please enter a valid email"}],password:[{required:!0,minLength:8,maxLength:25,msg:"Please enter a password of at least 8 characters."},{pattern:/[^\w\d]*(([0-9]+.*[A-Za-z]+.*)|[A-Za-z]+.*([0-9]+.*))/,msg:"Password must contain at least 1 letter and 1 number."}]},url:function(){var a="/register";return this.id&&(a="/accounts/"+this.id),a},initialize:function(){}}),ParticleFire.Collections.User=Backbone.Collection.extend({model:ParticleFire.Models.User,url:function(){return"/accounts"},initialize:function(){}}),ParticleFire.Views.Modal=Backbone.View.extend({header:"Great template",contentTemplate:_.template("Hi, How ya doin?"),modalTemplate:_.template(ParticleFire.Templates.Modal),type:"form",events:{},initialize:function(a){this.render()},render:function(a){var b={};b.header=this.header,this.$content=$(this.modalTemplate(b)),this.$modalBody=this.$content.find(".modal-body"),this.$modalBody.html(this.contentTemplate(a)),this.$content.modal(),this.$el=this.$content,this.onRender()},onRender:function(){},close:function(){this.$content.modal("hide")}}),ParticleFire.Views.ControlPanel=Backbone.View.extend({events:{"click .add-profile":"addProfile"},initialize:function(a){this.profile_id=a.profile_id,this.$profileList=this.$(".profile-list"),this.$profileListContent=this.$(".profile-tab-content"),this.collection=ParticleFire.App.profiles,this.profileViews=[],this.listenTo(this.collection,"sync",this.render),this.templates={profileTab:_.template(ParticleFire.Templates.ProfileTab),profileContent:_.template(ParticleFire.Templates.TabProfileContent)},this.$profileList.html(ParticleFire.Templates.Loader_Profiles)},render:function(){this.$profileList.html(""),this.collection.length>0?(this.profile_id||(this.profile_id=this.collection.at(0).id),this.renderAllProfiles()):this.$profileListContent.append(ParticleFire.Templates.NoProfiles)},loadProfiles:function(){this.collection.fetch()},renderAllProfiles:function(){var a=this;_.each(this.collection.models,function(b){a.renderProfile(b)})},renderProfile:function(a){var b=a.toJSON(),c="profile-"+a.id,d=a.id==this.profile_id;b.profile_content_id=c,b.classes=d?"active":"",b.active=d,this.$profileList.append(this.templates.profileTab(b)),this.$profileListContent.append(this.templates.profileContent(b));var e=new ParticleFire.Views.Profile({el:"#"+c,model:a});this.profileViews.push(e),d&&e.activate()},addProfile:function(){this.profileEditView=new ParticleFire.Views.ProfileEdit({model:new ParticleFire.Models.Profile})}}),ParticleFire.Views.IO=Backbone.View.extend({typeTemplates:{trigger:_.template(ParticleFire.Templates.IO_trigger)},events:{"click .cell-io-edit":"editIO","click .io-trigger":"triggerAction"},initialize:function(a){this.model=a.model,this.$parentEl=a.$parentEl,this.render()},render:function(){var a=this.model.toJSON();this.el=this.typeTemplates[this.model.get("type")](a),this.$el=$(this.el),this.$parentEl.append(this.$el),this.delegateEvents()},editIO:function(){var a={};a.model=this.model,this.ioEditView=new ParticleFire.Views.IOEdit(a)},triggerAction:function(){this.model.triggerAction()}}),ParticleFire.Views.IOEdit=ParticleFire.Views.Modal.extend({contentTemplate:_.template(ParticleFire.Templates.IOEditContent),ioTypeTemplates:{trigger:_.template(ParticleFire.Templates.IOEditType_trigger),toggle:_.template(ParticleFire.Templates.IOEditType_toggle),power_buttons:_.template(ParticleFire.Templates.IOEditType_trigger),reading:_.template(ParticleFire.Templates.IOEditType_trigger),video:_.template(ParticleFire.Templates.IOEditType_trigger)},events:{"click .btn-save":"saveIO"},initialize:function(a){this.model=a.model,this.headerText="New IO",this.model.id&&(this.headerText="Edit IO"),this.header='<span><i class="fa fa-gg"></i>&nbsp;&nbsp;'+this.headerText+"</span>",this.render(this.model.toJSON())},onRender:function(a){this.$ioFields=$(".modal.in .io-type-fields"),this.typesDropdown=new BootstrapSelect({el:".modal.in .io-types-select",values:this.model.types,value:this.model.get("type")}),this.typesDropdown.bind("change",this.renderIOFields,this),this.delegateEvents()},renderIOFields:function(a){this.$ioFields.html(this.ioTypeTemplates[a](this.model.toJSON())),this.deviceDropdown=new BootstrapSelect({el:".modal.in .io-devices-select",values:ParticleFire.App.user.devices.toJSON(),labelAttribute:"external_id",valueAttribute:"_id"})},saveIO:function(){var a=this,b={};$(".modal.in form input,.modal.in form select").each(function(){var a=$(this);console.log("SAVE2"),console.log(a);var c=a.val();console.log(c),c&&""!=$.trim(c)&&(b[a.attr("name")]=c)}),this.model.set(b),this.model.save([],{success:function(b,c){a.close()},error:function(a,b){var c=b.responseJSON?b.responseJSON.error:"There was an error saving. Please try again.";$.growl.error({message:c})}})}}),ParticleFire.Views.Profile=Backbone.View.extend({events:{"click .add-io":"addIO"},initialize:function(a){this.model=a.model,this.active=!1,this.collection=new ParticleFire.Collections.IO([],{profile_id:this.model.id}),this.listenTo(this.collection,"sync",this.renderIOs),this.ioViews=[],this.templates={profile:_.template(ParticleFire.Templates.Profile),IO:_.template(ParticleFire.Templates.IO)},this.render()},render:function(){var a=this.model.toJSON();this.$el.html(this.templates.profile(a)),this.$IOList=this.$(".io-list"),a.ios&&(this.collection.set(a.ios),this.renderIOs())},renderIOs:function(){console.log("REDER IOS"),this.$IOList.html(""),this.collection.length>0&&this.renderAllIOs()},activate:function(){this.active=!0,this.loadIOs()},loadIOs:function(){this.collection.fetch()},renderAllIOs:function(){var a=this;_.each(this.collection.models,function(b){a.renderIO(b)})},renderIO:function(a){this.ioViews.push(new ParticleFire.Views.IO({model:a,$parentEl:this.$IOList}))},addIO:function(){var a={};a.model=new ParticleFire.Models.IO({profile_id:this.model.id}),this.ioEditView=new ParticleFire.Views.IOEdit(a)}}),ParticleFire.Views.ProfileEdit=ParticleFire.Views.Modal.extend({contentTemplate:_.template(ParticleFire.Templates.ProfileEditContent),events:{"click .btn-save":"saveProfile","click .btn-cancel":"close"},initialize:function(a){this.model=a.model,this.headerText="New Profile",this.model.id&&(this.headerText="Edit Profile"),this.header='<span><i class="fa fa-gg"></i>&nbsp;&nbsp;'+this.headerText+"</span>",this.render(this.model.toJSON())},onRender:function(){this.$el.find("#profile-name").focus(),this.delegateEvents()},saveProfile:function(){var a=this;this.model.set({name:this.$el.find("#profile-name").val()}),this.model.save([],{success:function(){a.close()},error:function(a,b){var c=b.responseJSON?b.responseJSON.error:"There was an error saving. Please try again.";$.growl.error({message:c})}})}}),ParticleFire.Views.Register=Backbone.View.extend({events:{"click .register-submit":"submit"},initialize:function(a){var b=new ParticleFire.Models.User({});this.model=b,this.render()},render:function(){_.bindFormView(this),Backbone.Validation.bind(this)},submit:function(a){a.preventDefault(),this.model.validate(),this.model.isValid()&&this.$el.submit()}}),ParticleFire.Routers.ControlPanel=Backbone.Router.extend({routes:{"":"initRoute","control-panel":"load"},initialize:function(a){Backbone.history.start()},initRoute:function(){this.navigate("control-panel",{trigger:!0,replace:!0})},load:function(){ParticleFire.App.controlPanel.loadProfiles()}});